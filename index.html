<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoTag Pro: Office Tools Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="./Assets/index.css">
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#0d6efd"> 

    <style>
        .modal.fullscreen .modal-dialog {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            max-width: none;
        }
        .modal.fullscreen .modal-content {
            height: 100%;
            border: 0;
        }
        /* Custom scrollbar for large tables on small screens */
        .table-responsive {
            max-height: 80vh; 
            overflow: auto;
        }
        /* Style for the inline edit fields to look clean */
        .lead-inline-edit {
            padding: 0.1rem 0.3rem;
            height: auto;
            border: 1px solid #ccc;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .lead-inline-edit:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, .25);
        }
        .lead-inline-edit.is-valid {
            border-color: #198754;
        }
    </style>
</head>
<body class="bg-light">

    <div id="notificationContainer" class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1050;"></div>
    
    <div id="installBanner" class="alert alert-primary mb-0 p-2 d-none" role="alert" style="z-index: 1040;">
        <span class="material-symbols-outlined me-2">install_mobile</span>
        Install this app for a better experience!
        <button id="installButton" class="btn btn-sm btn-primary ms-3">Install</button>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top shadow">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">GeoTag Pro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item d-none d-lg-block">
                        <div id="googleSignInButtonContainer" class="d-flex align-items-center">
                             <button class="btn btn-light" onclick="window.googleLogin()">
                                <img src="./Assets/icons/google-logo.svg" alt="Google" style="width: 18px; margin-right: 8px;">
                                Sign in with Google
                            </button>
                        </div>
                    </li>
                    <li class="nav-item dropdown d-none" id="userProfileDisplay">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img id="userPhoto" src="./Assets/icons/icon-256x256.png" class="rounded-circle me-2" alt="User" style="width: 30px; height: 30px; object-fit: cover;">
                            <span id="userName">User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#profileModal">View Profile</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="window.signOutUser()">Sign Out</a></li>
                        </ul>
                    </li>
                    <li class="nav-item d-block d-lg-none">
                        <a class="nav-link text-white" href="#" onclick="window.googleLogin()">Sign In</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
            
            <div class="col">
                <div class="card shadow-sm tool-card" data-bs-toggle="modal" data-bs-target="#leadManageModal">
                    <div class="card-body">
                        <h3 class="card-title h5 text-primary">Lead Data Management</h3>
                        <p class="card-text small text-muted">View, edit, and manage all your stored lead entries and contacts.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card shadow-sm tool-card" data-bs-toggle="modal" data-bs-target="#digitSpellerModal">
                    <div class="card-body">
                        <h3 class="card-title h5 text-success">Digit Speller (Indian)</h3>
                        <p class="card-text small text-muted">Convert numerical digits into words using the Indian number system.</p>
                    </div>
                </div>
            </div>
            
            <div class="col">
                <div class="card shadow-sm tool-card" data-bs-toggle="modal" data-bs-target="#denominationModal">
                    <div class="card-body">
                        <h3 class="card-title h5 text-warning">Cash Denomination Tally</h3>
                        <p class="card-text small text-muted">Quickly calculate total cash amount based on note and coin counts.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card shadow-sm tool-card" data-bs-toggle="modal" data-bs-target="#emiCalculatorModal">
                    <div class="card-body">
                        <h3 class="card-title h5 text-danger">EMI Calculator</h3>
                        <p class="card-text small text-muted">Calculate Equated Monthly Installment (EMI) for loans.</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <button id="quickNoteFab" class="btn btn-primary rounded-circle shadow-lg position-fixed bottom-0 end-0 m-3 d-none" 
            data-bs-toggle="modal" data-bs-target="#quickNoteModal" title="Quick Notes" style="width: 60px; height: 60px;">
        <span class="material-symbols-outlined fs-3">note_add</span>
    </button>
    
    <div class="modal fade fullscreen" id="leadManageModal" tabindex="-1" aria-labelledby="leadManageModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white p-2">
                    <h5 class="modal-title h6" id="leadManageModalLabel">Lead Data Management</h5>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-sm btn-light me-2" id="addLeadFromManageBtn">
                            <span class="material-symbols-outlined fs-6" style="vertical-align: sub;">person_add</span> Add New Lead
                        </button>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body p-2">
                    <div class="mb-2">
                        <input type="text" class="form-control form-control-sm" id="leadSearchInput" placeholder="Search by name, mobile, or remark...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-sm align-middle" id="notesTable">
                            <thead class="bg-light sticky-top" style="top: 0;">
                                <tr>
                                    <th scope="col" class="small">S.No</th>
                                    <th scope="col" class="small">Customer Name</th>
                                    <th scope="col" class="small">Mobile Number</th>
                                    <th scope="col" class="small">Lead For</th>
                                    <th scope="col" class="small">Lead By</th>
                                    <th scope="col" class="small">Last Contact</th>
                                    <th scope="col" class="small">Remark</th>
                                    <th scope="col" class="small">Date Added</th>
                                    <th scope="col" class="small">Last Edited</th>
                                    <th scope="col" class="small">Call</th>
                                    <th scope="col" class="small">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="leadEntryModal" tabindex="-1" aria-labelledby="leadEntryModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="leadEntryModalLabel">Add New Lead Entry</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="noteEntryForm">
                        <div class="mb-3">
                            <label for="customerName" class="form-label small">Customer Name</label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="mobileNumber" class="form-label small">Mobile Number</label>
                            <input type="tel" class="form-control" id="mobileNumber" required>
                        </div>
                        <div class="mb-3">
                            <label for="leadFor" class="form-label small">Lead For</label>
                            <select class="form-select" id="leadFor">
                                <option value="Property">Property</option>
                                <option value="Investment">Investment</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="leadBy" class="form-label small">Lead By / Source</label>
                            <input type="text" class="form-control" id="leadBy">
                        </div>
                        <div class="mb-3">
                            <label for="lastContact" class="form-label small">Last Contact Date</label>
                            <input type="date" class="form-control" id="lastContact" value="">
                        </div>
                        <div class="mb-3">
                            <label for="remark" class="form-label small">Remark / Follow-up Note</label>
                            <textarea class="form-control" id="remark" rows="3"></textarea>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-success">Save Lead</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="leadEditModal" tabindex="-1" aria-labelledby="leadEditModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="leadEditModalLabel">Edit Lead Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editLeadRtdbKey">
                    <div class="mb-3">
                        <label for="editCustomerName" class="form-label small">Customer Name</label>
                        <input type="text" class="form-control" id="editCustomerName" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="editMobileNumber" class="form-label small">Mobile Number</label>
                        <input type="tel" class="form-control" id="editMobileNumber" required>
                    </div>
                    <div class="mb-3">
                        <label for="editLeadFor" class="form-label small">Lead For</label>
                        <select class="form-select" id="editLeadFor">
                            <option value="Property">Property</option>
                            <option value="Investment">Investment</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editLeadBy" class="form-label small">Lead By / Source</label>
                        <input type="text" class="form-control" id="editLeadBy">
                    </div>
                    <div class="mb-3">
                        <label for="editLastContact" class="form-label small">Last Contact Date</label>
                        <input type="date" class="form-control" id="editLastContact">
                    </div>
                    <div class="mb-3">
                        <label for="editRemark" class="form-label small">Remark / Follow-up Note</label>
                        <textarea class="form-control" id="editRemark" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" id="saveLeadChanges">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="quickNoteModal" tabindex="-1" aria-labelledby="quickNoteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="quickNoteModalLabel">Quick Notes</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Add New Note</h6>
                    <form id="quickNoteForm" class="mb-4">
                        <textarea class="form-control mb-2" id="noteTextarea" rows="3" placeholder="Type your quick note here..."></textarea>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-sm btn-info text-white">Save Note</button>
                        </div>
                    </form>
                    <h6>Saved Notes</h6>
                    <div id="savedNotesContainer">
                        </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="digitSpellerModal" tabindex="-1" aria-labelledby="digitSpellerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="digitSpellerModalLabel">Digit to Word Speller (Indian)</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="digitInput" class="form-label small">Enter Number (Max 9 Digits)</label>
                        <input type="number" class="form-control" id="digitInput" max="999999999" placeholder="e.g., 10000000">
                    </div>
                    <h6>Result:</h6>
                    <p class="alert alert-light fw-bold" id="spellingOutput">Enter a number to see the spelling.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="denominationModal" tabindex="-1" aria-labelledby="denominationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="denominationModalLabel">Cash Denomination Tally</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm text-nowrap">
                            <thead>
                                <tr>
                                    <th>Denomination</th>
                                    <th class="text-center">Count</th>
                                    <th class="text-end">Amount (₹)</th>
                                </tr>
                            </thead>
                            <tbody id="denominationTallyBody">
                                </tbody>
                            <tfoot>
                                <tr class="table-primary">
                                    <th colspan="2">GRAND TOTAL</th>
                                    <th class="text-end" id="grandTotalDisplay">₹0</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="emiCalculatorModal" tabindex="-1" aria-labelledby="emiCalculatorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="emiCalculatorModalLabel">EMI Calculator</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="principalInput" class="form-label small">Loan Amount (₹)</label>
                                <input type="number" class="form-control emi-calc-input" id="principalInput" value="500000" min="0">
                            </div>
                            <div class="mb-3">
                                <label for="timeInput" class="form-label small">Loan Term (Years)</label>
                                <input type="number" class="form-control emi-calc-input" id="timeInput" value="5" min="0.5" step="0.5">
                            </div>
                            <div class="mb-3">
                                <label for="rateSlider" class="form-label small">Interest Rate: <span id="rateDisplay">10.00%</span></label>
                                <input type="range" class="form-range emi-calc-input" id="rateSlider" min="1" max="25" step="0.01" value="10">
                            </div>
                            
                            <h6 class="mt-4">Results:</h6>
                            <ul class="list-group list-group-flush small">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Monthly EMI:
                                    <span class="badge bg-primary rounded-pill" id="outputEMI">₹0</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Total Interest:
                                    <span class="badge bg-danger rounded-pill" id="outputTotalInterest">₹0</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Total Payment:
                                    <span class="badge bg-success rounded-pill" id="outputTotalPayment">₹0</span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <canvas id="emiPieChart" style="height: 200px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="profileModalLabel">User Profile</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalUserPhoto" src="./Assets/icons/icon-256x256.png" class="rounded-circle mb-3" alt="User" style="width: 100px; height: 100px; object-fit: cover;">
                    <h5 id="modalUserName">User</h5>
                    <p class="text-muted" id="modalUserEmail">N/A</p>
                    <hr>
                    <button class="btn btn-outline-danger" onclick="window.signOutUser()" data-bs-dismiss="modal">Sign Out</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-analytics.js";
      import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
      import * as database from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";
      
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY", // REPLACE with your actual API key
        authDomain: "officetools-629fc.firebaseapp.com",
        databaseURL: "https://officetools-629fc-default-rtdb.firebaseio.com", 
        projectId: "officetools-629fc",
        storageBucket: "officetools-629fc.appspot.com",
        messagingSenderId: "1098616118671",
        appId: "1:1098616118671:web:96e22f2a7146e49257e875",
        measurementId: "G-8QE15667LC"
      };
      
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);
      const db = database.getDatabase(app);
      const googleProvider = new GoogleAuthProvider();
      
      window.FIREBASE_USER_UID = null;
      window.isFirebaseAuthComplete = false;
      window.RTDB = db;

      // Define the global 'firebase' object so tool.js can access it
      window.firebase = { 
        auth: auth, 
        database: database,
        googleProvider: googleProvider,
        signInWithPopup: signInWithPopup,
      };
      
      // Global Authentication State Listener
      onAuthStateChanged(auth, user => {
          if (user) {
              window.FIREBASE_USER_UID = user.uid;
              window.isFirebaseAuthComplete = true;
              if (typeof firebaseAuthSuccessHandler === 'function') {
                  firebaseAuthSuccessHandler(user);
              }
          } else {
              if (typeof firebaseAuthRequiredHandler === 'function') {
                  firebaseAuthRequiredHandler();
              }
          }
      });
      
    </script>

    <script src="./tool.js"></script>
    <script src="./tool1.js"></script>
    
</body>
</html>
