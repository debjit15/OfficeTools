<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoTag Pro Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#0d6efd"> 

    <style>
        :root {
            --bs-primary: #0d6efd;
            --bs-primary-rgb: 13, 110, 253;
            --bs-dashboard-bg: #f8f9fa; /* Light Gray */
        }
        body {
            background-color: var(--bs-dashboard-bg);
        }
        .modal.fullscreen .modal-dialog {
            width: 100vw;
            height: 100vh;
            margin: 0;
            max-width: none;
        }
        .modal.fullscreen .modal-content {
            height: 100%;
            border: 0;
        }
        /* Premium Card Look */
        .tool-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            border-radius: 12px; /* Smoother corners */
            border: none;
            overflow: hidden;
            background: white;
        }
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,.08) !important;
        }
        .tool-card.disabled-for-auth {
            cursor: not-allowed;
            opacity: 0.6;
            background-color: #f1f1f1;
        }
        .tool-card-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        /* Responsive Table */
        .table-responsive-lg {
            max-height: calc(100vh - 180px); /* Adjust height for full-screen modal */
            overflow: auto;
        }
        /* Inline Edit Styling */
        .lead-inline-edit {
            padding: 0.25rem 0.4rem;
            font-size: 0.8rem;
            height: auto;
            border: 1px solid #dee2e6;
            border-radius: 6px;
        }
        .lead-inline-edit:focus {
            border-color: var(--bs-primary);
            box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, .15);
        }
        .lead-inline-edit.is-valid {
            border-color: #198754;
            background-color: #d1e7dd; /* Light green background */
        }
        .lead-inline-edit.is-invalid {
            border-color: #dc3545;
            background-color: #f8d7da; /* Light red background */
        }
    </style>
</head>
<body>

    <div id="notificationContainer" class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1050;"></div>
    
    <div id="installBanner" class="alert alert-dark mb-0 p-2 d-none shadow-lg" role="alert" style="z-index: 1040;">
        <span class="material-symbols-outlined me-2">download</span>
        Install app for a full-screen, faster experience.
        <button id="installButton" class="btn btn-sm btn-outline-dark ms-3">Install</button>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow-lg">
        <div class="container-fluid">
            <button class="navbar-toggler me-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNav" aria-controls="offcanvasNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand fw-bold" href="#">GeoTag Pro <span class="badge bg-primary ms-2 small" id="authRequiredBadge">Login Required</span></a>
            
            <div class="d-flex align-items-center">
                <div id="googleSignInButtonContainer" class="me-3">
                     <button class="btn btn-light btn-sm fw-semibold" onclick="window.googleLogin()">
                        <img src="./Assets/icons/google-logo.svg" alt="G" style="width: 18px; margin-right: 8px;">
                        Sign In
                    </button>
                </div>
                
                <div class="dropdown d-none" id="userProfileDisplay">
                    <a class="nav-link dropdown-toggle d-flex align-items-center p-0" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <img id="userPhoto" src="./Assets/icons/icon-256x256.png" class="rounded-circle me-2 border border-3 border-light" alt="User" style="width: 38px; height: 38px; object-fit: cover;">
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end shadow-lg" aria-labelledby="navbarDropdown">
                        <li><h6 class="dropdown-header fw-bold" id="userName">User</h6></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#profileModal">View Profile</a></li>
                        <li><a class="dropdown-item text-danger fw-semibold" href="#" onclick="window.signOutUser()">Sign Out</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="offcanvas offcanvas-start bg-dark text-white" tabindex="-1" id="offcanvasNav" aria-labelledby="offcanvasNavLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title fw-bold text-primary" id="offcanvasNavLabel">GeoTag Pro Tools</h5>
            <button type="button" class="btn-close text-reset btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body d-flex flex-column">
            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item mb-2">
                    <a class="btn btn-outline-light d-flex align-items-center w-100" data-bs-toggle="modal" data-bs-target="#leadManageModal" href="#">
                        <span class="material-symbols-outlined me-2">dns</span> Lead Manager
                    </a>
                </li>
                <li class="nav-item mb-2">
                    <a class="btn btn-outline-light d-flex align-items-center w-100" data-bs-toggle="modal" data-bs-target="#digitSpellerModal" href="#">
                        <span class="material-symbols-outlined me-2">calculate</span> Digit Speller
                    </a>
                </li>
                <li class="nav-item mb-2">
                    <a class="btn btn-outline-light d-flex align-items-center w-100" data-bs-toggle="modal" data-bs-target="#denominationModal" href="#">
                        <span class="material-symbols-outlined me-2">currency_rupee</span> Cash Tally
                    </a>
                </li>
                <li class="nav-item mb-2">
                    <a class="btn btn-outline-light d-flex align-items-center w-100" data-bs-toggle="modal" data-bs-target="#emiCalculatorModal" href="#">
                        <span class="material-symbols-outlined me-2">percent</span> EMI Calculator
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="container-fluid py-4">
        <h1 class="h3 fw-bold mb-4 text-dark">Dashboard Overview</h1>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
            
            <div class="col">
                <div class="card shadow-sm tool-card" id="leadManageCard" data-bs-toggle="modal" data-bs-target="#leadManageModal">
                    <div class="card-body d-flex flex-column align-items-start">
                        <span class="material-symbols-outlined text-primary tool-card-icon">dns</span>
                        <h3 class="card-title h5 text-dark fw-bold">Lead Data Management</h3>
                        <p class="card-text small text-muted">View, edit, and manage all your stored lead entries and contacts.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card shadow-sm tool-card" data-bs-toggle="modal" data-bs-target="#digitSpellerModal">
                    <div class="card-body d-flex flex-column align-items-start">
                        <span class="material-symbols-outlined text-success tool-card-icon">calculate</span>
                        <h3 class="card-title h5 text-dark fw-bold">Digit Speller (Indian)</h3>
                        <p class="card-text small text-muted">Convert numerical digits into words using the Indian number system.</p>
                    </div>
                </div>
            </div>
            
            <div class="col">
                <div class="card shadow-sm tool-card" data-bs-toggle="modal" data-bs-target="#denominationModal">
                    <div class="card-body d-flex flex-column align-items-start">
                        <span class="material-symbols-outlined text-warning tool-card-icon">currency_rupee</span>
                        <h3 class="card-title h5 text-dark fw-bold">Cash Denomination Tally</h3>
                        <p class="card-text small text-muted">Quickly calculate total cash amount based on note and coin counts.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card shadow-sm tool-card" data-bs-toggle="modal" data-bs-target="#emiCalculatorModal">
                    <div class="card-body d-flex flex-column align-items-start">
                        <span class="material-symbols-outlined text-danger tool-card-icon">percent</span>
                        <h3 class="card-title h5 text-dark fw-bold">EMI Calculator</h3>
                        <p class="card-text small text-muted">Calculate Equated Monthly Installment (EMI) for loans.</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <button id="quickNoteFab" class="btn btn-primary rounded-circle shadow-lg position-fixed bottom-0 end-0 m-3 d-none" 
            data-bs-toggle="modal" data-bs-target="#quickNoteModal" title="Quick Notes" style="width: 56px; height: 56px;">
        <span class="material-symbols-outlined fs-4">edit_note</span>
    </button>
    
    <div class="modal fade fullscreen" id="leadManageModal" tabindex="-1" aria-labelledby="leadManageModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white p-3 shadow-sm">
                    <h5 class="modal-title h6 fw-bold" id="leadManageModalLabel">Lead Data Management</h5>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-sm btn-primary fw-semibold me-2" id="addLeadFromManageBtn" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#leadEntryModal">
                            <span class="material-symbols-outlined fs-6" style="vertical-align: sub;">person_add</span> Add New Lead
                        </button>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body p-2 p-md-3">
                    <div class="mb-3">
                        <input type="text" class="form-control form-control-lg shadow-sm" id="leadSearchInput" placeholder="Search leads by name, mobile, or remark...">
                    </div>
                    
                    <div class="table-responsive table-responsive-lg">
                        <table class="table table-striped table-hover table-sm align-middle" id="notesTable">
                            <thead class="bg-light sticky-top shadow-sm" style="top: 0; z-index: 10;">
                                <tr>
                                    <th scope="col" class="small">S.No</th>
                                    <th scope="col" class="small">Customer Name</th>
                                    <th scope="col" class="small">Mobile Number</th>
                                    <th scope="col" class="small">Lead For</th>
                                    <th scope="col" class="small">Lead By</th>
                                    <th scope="col" class="small">Last Contact</th>
                                    <th scope="col" class="small">Remark</th>
                                    <th scope="col" class="small">Date Added</th>
                                    <th scope="col" class="small">Last Edited</th>
                                    <th scope="col" class="small">Call</th>
                                    <th scope="col" class="small">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="leadEntryModal" tabindex="-1" aria-labelledby="leadEntryModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="leadEntryModalLabel">Add New Lead Entry</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="noteEntryForm">
                        <div class="mb-3">
                            <label for="customerName" class="form-label small fw-semibold">Customer Name</label>
                            <input type="text" class="form-control shadow-sm" id="customerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="mobileNumber" class="form-label small fw-semibold">Mobile Number</label>
                            <input type="tel" class="form-control shadow-sm" id="mobileNumber" required>
                        </div>
                        <div class="mb-3">
                            <label for="leadFor" class="form-label small fw-semibold">Lead For</label>
                            <select class="form-select shadow-sm" id="leadFor">
                                <option value="Property">Property</option>
                                <option value="Investment">Investment</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="leadBy" class="form-label small fw-semibold">Lead By / Source</label>
                            <input type="text" class="form-control shadow-sm" id="leadBy">
                        </div>
                        <div class="mb-3">
                            <label for="lastContact" class="form-label small fw-semibold">Last Contact Date</label>
                            <input type="date" class="form-control shadow-sm" id="lastContact" value="">
                        </div>
                        <div class="mb-3">
                            <label for="remark" class="form-label small fw-semibold">Remark / Follow-up Note</label>
                            <textarea class="form-control shadow-sm" id="remark" rows="3"></textarea>
                        </div>
                        <div class="d-grid pt-2">
                            <button type="submit" class="btn btn-success btn-lg shadow">Save Lead</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="leadEditModal" tabindex="-1" aria-labelledby="leadEditModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="leadEditModalLabel">Edit Lead Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editLeadRtdbKey">
                    <div class="mb-3">
                        <label for="editCustomerName" class="form-label small fw-semibold">Customer Name</label>
                        <input type="text" class="form-control shadow-sm" id="editCustomerName" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="editMobileNumber" class="form-label small fw-semibold">Mobile Number</label>
                        <input type="tel" class="form-control shadow-sm" id="editMobileNumber" required>
                    </div>
                    <div class="mb-3">
                        <label for="editLeadFor" class="form-label small fw-semibold">Lead For</label>
                        <select class="form-select shadow-sm" id="editLeadFor">
                            <option value="Property">Property</option>
                            <option value="Investment">Investment</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editLeadBy" class="form-label small fw-semibold">Lead By / Source</label>
                        <input type="text" class="form-control shadow-sm" id="editLeadBy">
                    </div>
                    <div class="mb-3">
                        <label for="editLastContact" class="form-label small fw-semibold">Last Contact Date</label>
                        <input type="date" class="form-control shadow-sm" id="editLastContact">
                    </div>
                    <div class="mb-3">
                        <label for="editRemark" class="form-label small fw-semibold">Remark / Follow-up Note</label>
                        <textarea class="form-control shadow-sm" id="editRemark" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning fw-bold" id="saveLeadChanges">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="quickNoteModal" tabindex="-1" aria-labelledby="quickNoteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="quickNoteModalLabel">Quick Notes</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Add New Note</h6>
                    <form id="quickNoteForm" class="mb-4">
                        <textarea class="form-control mb-2 shadow-sm" id="noteTextarea" rows="3" placeholder="Type your quick note here..."></textarea>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-sm btn-info text-white fw-semibold">Save Note</button>
                        </div>
                    </form>
                    <hr>
                    <h6 class="mb-3">Saved Notes</h6>
                    <div id="savedNotesContainer">
                        </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="digitSpellerModal" tabindex="-1" aria-labelledby="digitSpellerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="digitSpellerModalLabel">Digit to Word Speller (Indian)</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="digitInput" class="form-label small fw-semibold">Enter Number (Max 9 Digits)</label>
                        <input type="number" class="form-control form-control-lg shadow-sm" id="digitInput" max="999999999" placeholder="e.g., 10000000">
                    </div>
                    <h6 class="mt-4">Spelling:</h6>
                    <p class="alert alert-light border border-success fw-bold p-3" id="spellingOutput">Enter a number to see the spelling.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="denominationModal" tabindex="-1" aria-labelledby="denominationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="denominationModalLabel">Cash Denomination Tally</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm">
                            <thead class="bg-light">
                                <tr>
                                    <th class="small">Denomination</th>
                                    <th class="text-center small">Count</th>
                                    <th class="text-end small">Amount (₹)</th>
                                </tr>
                            </thead>
                            <tbody id="denominationTallyBody">
                                </tbody>
                            <tfoot>
                                <tr class="table-primary fw-bold">
                                    <th colspan="2" class="text-end">GRAND TOTAL</th>
                                    <th class="text-end" id="grandTotalDisplay">₹0</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="emiCalculatorModal" tabindex="-1" aria-labelledby="emiCalculatorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="emiCalculatorModalLabel">EMI Calculator</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 border-end">
                            <h6 class="fw-bold text-danger mb-3">Input Parameters</h6>
                            <div class="mb-3">
                                <label for="principalInput" class="form-label small fw-semibold">Loan Amount (₹)</label>
                                <input type="number" class="form-control emi-calc-input shadow-sm" id="principalInput" value="500000" min="0">
                            </div>
                            <div class="mb-3">
                                <label for="timeInput" class="form-label small fw-semibold">Loan Term (Years)</label>
                                <input type="number" class="form-control emi-calc-input shadow-sm" id="timeInput" value="5" min="0.5" step="0.5">
                            </div>
                            <div class="mb-4">
                                <label for="rateSlider" class="form-label small fw-semibold">Interest Rate: <span id="rateDisplay" class="fw-bold text-danger">10.00%</span></label>
                                <input type="range" class="form-range emi-calc-input" id="rateSlider" min="1" max="25" step="0.01" value="10">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold text-dark mb-3">Calculation Results</h6>
                            <ul class="list-group list-group-flush mb-4">
                                <li class="list-group-item d-flex justify-content-between align-items-center fw-semibold">
                                    Monthly EMI:
                                    <span class="badge bg-primary fs-6 rounded-pill p-2" id="outputEMI">₹0</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center small">
                                    Total Principal:
                                    <span class="text-success" id="outputPrincipal">₹5,00,000</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center small">
                                    Total Interest Payable:
                                    <span class="text-danger" id="outputTotalInterest">₹0</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center fw-semibold">
                                    Total Payment:
                                    <span class="text-dark" id="outputTotalPayment">₹0</span>
                                </li>
                            </ul>
                            <div style="height: 250px;">
                                <canvas id="emiPieChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="profileModalLabel">User Profile</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalUserPhoto" src="./Assets/icons/icon-256x256.png" class="rounded-circle mb-3 border border-3 border-primary" alt="User" style="width: 100px; height: 100px; object-fit: cover;">
                    <h5 id="modalUserName" class="fw-bold">User</h5>
                    <p class="text-muted small" id="modalUserEmail">N/A</p>
                    <hr>
                    <button class="btn btn-danger fw-semibold" onclick="window.signOutUser()" data-bs-dismiss="modal">Sign Out</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-analytics.js";
      import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
      import * as database from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";
      
      const firebaseConfig = {
  apiKey: "AIzaSyCLb8Fcl_Yqqd0EYXciu5wbrAj7-mz1o9M",
  authDomain: "officetools-629fc.firebaseapp.com",
  databaseURL: "https://officetools-629fc-default-rtdb.firebaseio.com",
  projectId: "officetools-629fc",
  storageBucket: "officetools-629fc.firebasestorage.app",
  messagingSenderId: "888485297465",
  appId: "1:888485297465:web:f832733b7b78d361067ce8",
  measurementId: "G-8QE15667LC"
};
      
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);
      const db = database.getDatabase(app);
      const googleProvider = new GoogleAuthProvider();
      
      window.FIREBASE_USER_UID = null;
      window.RTDB = db;

      // Define the global 'firebase' object so tool1.js can access all components
      window.firebase = { 
        auth: { ...auth, signOut: signOut }, 
        database: database,
        googleProvider: googleProvider,
        signInWithPopup: signInWithPopup,
      };
      
      // Global Authentication State Listener
      onAuthStateChanged(auth, user => {
          if (user) {
              window.FIREBASE_USER_UID = user.uid;
              // Check if handler is loaded from tool1.js
              if (typeof firebaseAuthSuccessHandler === 'function') {
                  firebaseAuthSuccessHandler(user);
              }
          } else {
              if (typeof firebaseAuthRequiredHandler === 'function') {
                  firebaseAuthRequiredHandler();
              }
          }
      });
      
    </script>

    <script src="./tool.js"></script>
    <script src="./tool1.js"></script>
    
</body>
</html>
