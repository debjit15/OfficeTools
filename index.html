<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoTag Pro: Office Tools Dashboard (Lead Management)</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="./Assets/index.css">
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#0d6efd"> 
  

    <style>
        /* Styles to ensure components are visually clear */
        #googleSignInButtonContainer {
            /* Now an explicit container for the simple button */
            display: flex; 
            align-items: center;
        }

        /* Existing Styles */
        #userPhoto {
            cursor: pointer;
        }
        .modal.fullscreen .modal-dialog {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            max-width: none;
        }
        .modal.fullscreen .modal-content {
            height: 100%;
            border: 0;
            border-radius: 0;
        }
        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1040;
        }
        .fab-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        .fab-button:hover {
            transform: scale(1.05);
        }
        #quickNoteForm .modal-body {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        #noteTextarea {
            flex-grow: 1;
            resize: none;
        }
    </style>

</head>

<body class="bg-body-bg">
    
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm" role="navigation" aria-label="Main Navigation">
        <div class="container-fluid container-xl">
            <a class="navbar-brand text-primary fw-bold d-flex align-items-center" href="#" aria-label="GeoTag Pro Office Tools Dashboard Home">
                <span class="material-symbols-outlined me-2">workspaces</span>
                Office Tools
            </a>
            
            <div class="actions ms-auto d-flex align-items-center" role="group" aria-label="User Actions">
                
                <div id="userProfileDisplay" class="d-flex align-items-center me-3 d-none" role="status" aria-label="User Profile">
                    <img id="userPhoto" src="" alt="User Profile Photo" class="rounded-circle me-2" style="width: 35px; height: 35px;" 
                         data-bs-toggle="modal" data-bs-target="#userAccountModal" title="View Profile">
                    <span id="userName" class="me-3 fw-medium d-none d-sm-block"></span>
                    <button class="btn btn-outline-danger btn-sm" onclick="signOutUser()" aria-label="Sign Out">
                        <span class="material-symbols-outlined fs-6" style="vertical-align: middle;">logout</span>
                    </button>
                </div>

                <div id="googleSignInButtonContainer">
                    <button class="btn btn-primary btn-sm" onclick="googleLogin()" aria-label="Sign in with Google">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="18px" height="18px" style="vertical-align: middle; margin-right: 5px;">
                            <path fill="#FFC107" d="M43.61 20.08v3.46h-11.72l-.02-.02c-2.45-3.52-6.52-5.9-11.19-5.9-8.58 0-15.54 6.96-15.54 15.54s6.96 15.54 15.54 15.54c5.96 0 10.9-3.32 13.56-8.24l.01-.01-5.18-4.01c-1.85 2.87-5.06 4.88-8.39 4.88-4.66 0-8.46-3.8-8.46-8.46s3.8-8.46 8.46-8.46c2.4 0 4.67 1.02 6.27 2.76l.01-.01L43.61 20.08z"/>
                            <path fill="#4CAF50" d="M11.66 11.66h24.68v24.68H11.66z" transform="rotate(45 24 24)" opacity="0"/>
                            <path fill="#4285F4" d="M43.61 20.08h-11.72l-.02-.02c-2.45-3.52-6.52-5.9-11.19-5.9-8.58 0-15.54 6.96-15.54 15.54s6.96 15.54 15.54 15.54c5.96 0 10.9-3.32 13.56-8.24l.01-.01 5.18 4.01c-3.13 4.79-8.48 7.82-14.9 7.82C10.8 44 2.88 36.08 2.88 26.54S10.8 9.08 20.88 9.08c6.91 0 12.83 4.13 15.54 10.02l.01.01h7.18z"/>
                        </svg>
                        Sign in with Google
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main role="main" aria-label="Application Tools Dashboard">
        
        <div class="dashboard-container row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
         
           <div class="col">
  <div class="alert alert-info d-flex align-items-center justify-content-between" id="installBanner" role="alert">
    <span>ðŸš€ Install GeoTag Tools for a full app experience!</span>
    <button class="btn btn-primary btn-sm p-0" id="installButton" 
            style="width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center;">
      <img src="/Assets/icons/icon-32x32.png" alt="Install" style="width:24px; height:24px;">
    </button>
  </div>
</div>

            <div class="col">
                <a href="geo.html" class="tool-card" aria-label="Launch GeoTagging Image tool">
                    <span class="material-symbols-outlined">add_location_alt</span>
                    <h3>GeoTagging Image</h3>
                    <p>Launch the camera interface to capture geotagged photos.</p>
                </a>
            </div>
            
            <div class="col">
                <div class="tool-card disabled-for-auth opacity-50" title="Login required to use this tool." role="button" data-bs-toggle="modal" data-bs-target="#leadManageModal">
                    <span class="material-symbols-outlined">storage</span>
                    <h3>Lead Data Management</h3>
                    <p>View the table, delete entries, and export/import data.</p>
                </div>
            </div>

            <div class="col">
                <div class="tool-card" data-bs-toggle="modal" data-bs-target="#spellingModal" role="button" aria-controls="spellingModal" aria-label="Open Digit to Spelling Converter">
                    <span class="material-symbols-outlined">spellcheck</span>
                    <h3>Digit to Spelling</h3>
                    <p>Convert large numeric values into written words.</p>
                </div>
            </div>
           
            <div class="col">
    <div class="tool-card" data-bs-toggle="modal" data-bs-target="#denominationModal" role="button" aria-label="Open Currency Denomination Calculator">
        <span class="material-symbols-outlined">payments</span>
        <h3>Note Denomination</h3>
        <p>Break down a total amount into specified notes and coins.</p>
    </div>
</div>

           <div class="col">
    <div class="tool-card" data-bs-toggle="modal" data-bs-target="#emiCalculatorModal" role="button" aria-controls="emiCalculatorModal" aria-label="Open Simple Interest Calculator">
        <span class="material-symbols-outlined">payments</span>
        <h3>Interest Calculator</h3>
        <p>Calculate simple interest on a principal amount.</p>
    </div>
</div>

        </div>
    </main>
    
    <div id="notificationContainer" style="position: fixed; top: 15px; right: 15px; z-index: 1050;"></div>

    <div class="fab-container d-none" id="quickNoteFab">
        <button type="button" class="fab-button btn btn-primary btn-lg" 
            data-bs-toggle="modal" data-bs-target="#quickNoteModal" title="Quick Note"
            aria-label="Open Quick Note module">
            <span class="material-symbols-outlined fs-3">bookmark_add</span>
        </button>
    </div>

    <div class="modal fade" id="userAccountModal" tabindex="-1" aria-labelledby="userAccountModalLabel" aria-hidden="true" role="dialog">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content text-center">
                <div class="modal-header d-block border-0 pb-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close profile"></button>
                </div>
                <div class="modal-body pt-0">
                    <img id="modalUserPhoto" src="" alt="User Profile Photo" class="rounded-circle mb-3" style="width: 80px; height: 80px;">
                    <h5 id="modalUserName" class="text-primary fw-bold mb-1">User Name</h5>
                    <p id="modalUserEmail" class="text-muted small">user.email@example.com</p>
                    <hr>
                    <button type="button" class="btn btn-danger w-100 mt-2" onclick="signOutUser(); bootstrap.Modal.getInstance(document.getElementById('userAccountModal')).hide();" aria-label="Sign Out of Application">
                        <span class="material-symbols-outlined me-1 fs-6">logout</span> Sign Out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade fullscreen" id="leadEntryModal" tabindex="-1" aria-labelledby="leadEntryModalLabel" aria-hidden="true" role="dialog">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-primary" id="leadEntryModalLabel">New Lead Entry Form</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close form"></button>
                </div>
                <form id="noteEntryForm">
                    <div class="modal-body">
                        <p class="text-muted small">Fill out the details below to add a new lead. Data is saved to Firebase Database.</p>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="customerName" class="form-label">Customer Name <span class="text-danger" aria-hidden="true">*</span></label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="mobileNumber" class="form-label">Mobile Number</label>
                                <input type="tel" class="form-control" id="mobileNumber">
                            </div>
                            <div class="col-md-6">
                                <label for="leadFor" class="form-label">Lead For</label>
                                <select class="form-select" id="leadFor">
                                    <option value="" selected disabled>Select...</option>
                                    <option value="New Project">New Project</option>
                                    <option value="Maintenance">Maintenance</option>
                                    <option value="Survey">Survey</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="leadBy" class="form-label">Lead By (Agent Name)</label>
                                <input type="text" class="form-control" id="leadBy">
                            </div>
                            <div class="col-md-6">
                                <label for="lastContact" class="form-label">Last Contact Date <span class="text-danger" aria-hidden="true">*</span></label>
                                <input type="date" class="form-control" id="lastContact" required>
                            </div>
                            <div class="col-md-6">
                                <label for="remark" class="form-label">Remark / Next Action</label>
                                <input type="text" class="form-control" id="remark">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" aria-label="Save new lead entry">
                            <span class="material-symbols-outlined me-1 fs-6">save</span> Save Lead
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="modal fade fullscreen" id="denominationModal" tabindex="-1" aria-labelledby="denominationModalLabel" aria-hidden="true" role="dialog">
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-primary" id="denominationModalLabel">Calculate Total from Note Counts</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close calculator"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted small">Enter the count for each note/coin denomination below to calculate the total cash amount.</p>
                
                <form id="noteCountForm">
                    <div id="denominationInputTable" class="table-responsive">
                        <table class="table table-sm table-striped align-middle mb-0">
                            <thead>
                                <tr class="table-primary">
                                    <th scope="col">Note / Coin</th>
                                    <th scope="col" class="text-center">Count</th>
                                    <th scope="col" class="text-end">Amount (â‚¹)</th>
                                </tr>
                            </thead>
                            <tbody id="denominationTallyBody">
                                </tbody>
                        </table>
                    </div>
                </form>

                <h6 class="mt-4 text-primary">Total Cash Amount:</h6>
                <div id="grandTotalDisplay" class="alert alert-success fw-bold fs-4 text-end" aria-atomic="true">
                    â‚¹0
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


    <div class="modal fade fullscreen" id="leadManageModal" tabindex="-1" aria-labelledby="leadManageModalLabel" aria-hidden="true" role="dialog">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-primary" id="leadManageModalLabel">Lead Data Management</h5>
                    <button type="button" class="btn btn-sm btn-success me-3" id="addLeadFromManageBtn" aria-label="Add new lead">
                        <span class="material-symbols-outlined me-1 fs-6">add</span> Add Lead
                    </button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close management view"></button>
                </div>
                <div class="modal-body">
                    
                    <div id="noteTableContainer" class="table-responsive" aria-live="polite">
                        <table class="table table-striped table-hover align-middle" id="notesTable" aria-label="Lead Data Table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Customer Name</th>
                                    <th>Mobile Number</th>
                                    <th>Lead For</th>
                                    <th>Lead By</th>
                                    <th>Last Contact</th>
                                    <th>Remark</th>
                                    <th>Date Added</th>
                                    <th>Call</th>
                                    <th>Delete</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade fullscreen" id="quickNoteModal" tabindex="-1" aria-labelledby="quickNoteModalLabel" aria-hidden="true" role="dialog">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-primary" id="quickNoteModalLabel">Quick Note</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close note entry"></button>
                </div>
                <form id="quickNoteForm">
                    <div class="modal-body">
                        <p class="text-muted small">Saved Notes:</p>
                        <div id="savedNotesContainer" class="mb-3 p-2 border rounded overflow-auto" style="max-height: 20vh;">
                            <p class="text-center text-muted small mb-0">No saved notes.</p>
                        </div>
                        <p class="text-muted small mt-2">New Note:</p>
                        <textarea class="form-control" id="noteTextarea" rows="4" placeholder="Type your new note here..." required></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" aria-label="Save quick note">
                            <span class="material-symbols-outlined me-1 fs-6">save</span> Save Note
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade fullscreen" id="spellingModal" tabindex="-1" aria-labelledby="spellingModalLabel" aria-hidden="true" role="dialog">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-primary" id="spellingModalLabel">Digit to Spelling Converter</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close converter"></button>
                </div>
                <div class="modal-body">
                    <label for="digitInput" class="form-label">Enter Numeric Value:</label>
                    <input type="number" class="form-control" id="digitInput" placeholder="e.g., 1234567" max="999999999999" aria-describedby="spellingOutput">
                    
                    <h6 class="mt-3 text-muted">Result in Words:</h6>
                    <div id="spellingOutput" aria-atomic="true">Enter a digit above.</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Done</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade fullscreen" id="emiCalculatorModal" tabindex="-1" aria-labelledby="emiCalculatorModalLabel" aria-hidden="true" role="dialog">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-primary" id="emiCalculatorModalLabel">Professional Loan/EMI Calculator</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close calculator"></button>
            </div>
            <div class="modal-body">
                <div class="row g-4">
                    <div class="col-lg-6">
                        <h6 class="text-secondary mb-3">Loan Details</h6>
                        
                        <div class="mb-4">
                            <label for="principalInput" class="form-label">Principal Loan Amount (P)</label>
                            <input type="number" class="form-control emi-calc-input" id="principalInput" placeholder="e.g., 500000" value="500000" min="1000">
                        </div>

                        <div class="mb-4">
                            <label for="timeInput" class="form-label">Loan Term (T in Years)</label>
                            <input type="number" class="form-control emi-calc-input" id="timeInput" placeholder="e.g., 5" value="5" min="1">
                        </div>

                        <div class="mb-4">
                            <label for="rateSlider" class="form-label d-flex justify-content-between">
                                Annual Interest Rate (R): <span class="fw-bold text-primary" id="rateDisplay">7.00%</span>
                            </label>
                            <input type="range" class="form-range emi-calc-input" id="rateSlider" min="1" max="25" step="0.01" value="7">
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <h6 class="text-secondary mb-3">Calculation Summary</h6>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <div class="card text-center h-100 shadow-sm">
                                    <div class="card-body">
                                        <p class="card-title text-muted mb-1 small">Monthly EMI</p>
                                        <h4 class="text-primary" id="outputEMI">--</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center h-100 shadow-sm">
                                    <div class="card-body">
                                        <p class="card-title text-muted mb-1 small">Total Interest</p>
                                        <h4 class="text-danger" id="outputTotalInterest">--</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center h-100 shadow-sm">
                                    <div class="card-body">
                                        <p class="card-title text-muted mb-1 small">Total Payment</p>
                                        <h4 class="text-success" id="outputTotalPayment">--</h4>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card p-3 shadow-sm">
                             <p class="text-center text-muted small mb-2">Principal vs. Interest Breakdown</p>
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="emiPieChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Done</button>
            </div>
        </div>
    </div>
</div>


    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
      import { 
        getAuth, 
        GoogleAuthProvider, 
        signInWithPopup, // <-- Function used for traditional Google Sign-In
        signInWithCredential, 
      } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js"; 
      import * as database from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

      // NOTE: Replace these placeholders with your actual Firebase Configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCLb8Fcl_Yqqd0EYXciu5wbrAj7-mz1o9M",
        authDomain: "officetools-629fc.firebaseapp.com",
        projectId: "officetools-629fc",
        storageBucket: "officetools-629fc.firebasestorage.app",
        messagingSenderId: "888485297465",
        appId: "1:888485297465:web:f832733b7b78d361067ce8",
        databaseURL: "https://officetools-629fc-default-rtdb.firebaseio.com", 
        measurementId: "G-8QE15667LC"
      };
      
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);
      const db = database.getDatabase(app);
      const googleProvider = new GoogleAuthProvider();
      
      window.FIREBASE_USER_UID = null;
      window.isFirebaseAuthComplete = false;
      window.RTDB = db;
      // Define the global 'firebase' object so tool.js can access it
      window.firebase = { 
        auth: auth, 
        database: database,
        googleProvider: googleProvider, // Added the provider for tool.js
        signInWithPopup: signInWithPopup, // Added the method for tool.js
      };
      
      // GIS Credential handler is removed as the standard button doesn't use it.
      
      // Global Authentication State Listener
      auth.onAuthStateChanged(user => {
          if (user) {
              window.FIREBASE_USER_UID = user.uid;
              window.isFirebaseAuthComplete = true;
              if (typeof firebaseAuthSuccessHandler === 'function') {
                  firebaseAuthSuccessHandler(user);
              }
          } else {
              if (typeof firebaseAuthRequiredHandler === 'function') {
                  firebaseAuthRequiredHandler();
              }
          }
      });
      
    </script>

    <script src="Assets/tool.js"></script>
    
</body>
</html>
